<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Availability</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #f9f9f9;
    color: #333;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 20px;
  }
  .day {
    background: #fff;
    border-left: 6px solid #3498db;
    margin: 10px 0;
    padding: 12px 16px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .day.today {
    border-left-color: #e67e22;
    background: #fff8f0;
  }
  .day-header {
    font-size: 1.1em;
    font-weight: bold;
    color: #2980b9;
  }
  .shift, .available {
    display: inline-block;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 0.95em;
  }
  .shift {
    background: #3498db;
    color: #fff;
    font-weight: bold;
  }
  .available {
    background: #2ecc71;
    color: #fff;
  }
  .shifts-container {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  @media(max-width:600px){
    body { padding: 10px; }
    .shift, .available { font-size: 0.9em; }
  }
</style>
</head>
<body>

<h1>My Availability</h1>
<div id="schedule">Loading...</div>

<script>
async function fetchSheetCSV() {
  const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS9tVTb3G8QAX3nCwB2uE7j8KHgUrBZxcS5vNXUqM7_zi7ouVaZTHct3trlk5SsdfR-oCYHo8LsoJsf/pub?output=csv";
  const res = await fetch(url);
  const text = await res.text();

  const rows = text.trim().split('\n').map(r => r.split(','));
  return rows.slice(1).map(r => ({
    date: r[0],
    shift: r[1] || '',
    start: r[2] || '',
    end: r[3] || ''
  }));
}

function getShiftIcon(start) {
  if (!start) return '';
  const hour = parseInt(start.split(':')[0], 10);
  if (hour < 12) return '🌞';
  if (hour < 18) return '🌤️';
  return '🌙';
}

function renderSchedule(data) {
  data.sort((a,b)=> new Date(a.date)-new Date(b.date));
  const container = document.getElementById('schedule');
  container.innerHTML = '';

  const todayStr = new Date().toISOString().split('T')[0];
  const grouped = {};
  data.forEach(d => { if(!grouped[d.date]) grouped[d.date]=[]; grouped[d.date].push(d); });

  for(const date in grouped){
    const dayDiv = document.createElement('div');
    dayDiv.className='day';
    if(date===todayStr) dayDiv.classList.add('today');

    const dayHeader = document.createElement('div');
    dayHeader.className='day-header';
    dayHeader.textContent=new Date(date).toDateString();
    dayDiv.appendChild(dayHeader);

    const shiftsContainer = document.createElement('div');
    shiftsContainer.className='shifts-container';

    grouped[date].forEach(d=>{
      if(d.shift){
        const icon = getShiftIcon(d.start);
        const shiftDiv=document.createElement('div');
        shiftDiv.className='shift';
        shiftDiv.textContent=`${icon} ${d.shift} | ${d.start} - ${d.end}`;
        shiftsContainer.appendChild(shiftDiv);

        if(d.start && d.start>'08:00'){
          const availBefore=document.createElement('div');
          availBefore.className='available';
          availBefore.textContent=`Available: 08:00 - ${d.start}`;
          shiftsContainer.appendChild(availBefore);
        }
        if(d.end && d.end<'23:59'){
          const availAfter=document.createElement('div');
          availAfter.className='available';
          availAfter.textContent=`Available: ${d.end} - 23:59`;
          shiftsContainer.appendChild(availAfter);
        }
      } else {
        const fullAvail=document.createElement('div');
        fullAvail.className='available';
        fullAvail.textContent='Available all day';
        shiftsContainer.appendChild(fullAvail);
      }
    });

    dayDiv.appendChild(shiftsContainer);
    container.appendChild(dayDiv);
  }
}

fetchSheetCSV().then(renderSchedule).catch(err=>{
  console.error("Failed to load sheet:",err);
  document.getElementById('schedule').innerHTML="<p style='color:red'>Failed to load availability. Make sure the sheet is published publicly.</p>";
});
</script>

</body>
</html>
