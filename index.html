<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Pwngotchi Availability</title>
<style>
  body {
    font-family: 'Courier New', monospace;
    background: #0d0d0d;
    color: #00ff99;
    margin: 0;
    padding: 10px;
  }
  h1 {
    text-align: center;
    color: #ff66ff;
    text-shadow: 0 0 4px #ff00ff;
  }
  .day {
    background: #111;
    border: 2px solid #00ff99;
    margin: 10px 0;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 0 10px #00ffaa;
  }
  .shift {
    background: #ff0066;
    color: #fff;
    padding: 5px;
    border-radius: 4px;
    margin-bottom: 5px;
  }
  .available {
    background: #00ff99;
    color: #000;
    padding: 5px;
    border-radius: 4px;
    margin-bottom: 5px;
  }
  @media(max-width:600px){
    body { padding:5px; }
    .day { padding:5px; }
  }
</style>
</head>
<body>

<h1>My Availability ðŸŒ¸ðŸŒ™</h1>
<div id="schedule">Loading...</div>

<script>
async function fetchSheet() {
  const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS9tVTb3G8QAX3nCwB2uE7j8KHgUrBZxcS5vNXUqM7_zi7ouVaZTHct3trlk5SsdfR-oCYHo8LsoJsf/pubhtml';
  const res = await fetch(url);
  const text = await res.text();

  // Parse the HTML as a DOM
  const parser = new DOMParser();
  const doc = parser.parseFromString(text, 'text/html');
  const table = doc.querySelector('table');
  if(!table) throw new Error("Table not found in published sheet");

  const rows = Array.from(table.querySelectorAll('tr')).slice(1); // skip header

  const data = rows.map(row => {
    const cells = row.querySelectorAll('td');
    return {
      date: cells[0]?.textContent.trim(),
      shift: cells[1]?.textContent.trim(),
      start: cells[2]?.textContent.trim(),
      end: cells[3]?.textContent.trim()
    };
  });

  return data;
}

function renderSchedule(data) {
  // Sort by date
  data.sort((a,b) => new Date(a.date) - new Date(b.date));

  const container = document.getElementById('schedule');
  container.innerHTML = '';

  data.forEach(d => {
    const dayDiv = document.createElement('div');
    dayDiv.className = 'day';

    const dayHeader = document.createElement('h3');
    dayHeader.textContent = d.date;
    dayDiv.appendChild(dayHeader);

    if(d.shift){
      const shiftDiv = document.createElement('div');
      shiftDiv.className = 'shift';
      shiftDiv.textContent = `${d.shift} | ${d.start} - ${d.end}`;
      dayDiv.appendChild(shiftDiv);

      if(d.start && d.start !== '00:00'){
        const availBefore = document.createElement('div');
        availBefore.className = 'available';
        availBefore.textContent = `Available: 00:00 - ${d.start}`;
        dayDiv.appendChild(availBefore);
      }

      if(d.end && d.end !== '23:59'){
        const availAfter = document.createElement('div');
        availAfter.className = 'available';
        availAfter.textContent = `Available: ${d.end} - 23:59`;
        dayDiv.appendChild(availAfter);
      }
    } else {
      const fullAvail = document.createElement('div');
      fullAvail.className = 'available';
      fullAvail.textContent = 'Available all day';
      dayDiv.appendChild(fullAvail);
    }

    container.appendChild(dayDiv);
  });
}

// Run everything
fetchSheet()
  .then(renderSchedule)
  .catch(err => {
    console.error(err);
    document.getElementById('schedule').innerHTML = "<p style='color:red'>Failed to load availability. Make sure the sheet is published publicly.</p>";
  });
</script>

</body>
</html>
